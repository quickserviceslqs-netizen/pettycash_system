{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard - Petty Cash System{% endblock %}

{% block content %}
<div style="max-width:1200px; margin:0 auto;">

    <!-- Welcome Section -->
    <section style="margin-bottom:30px; text-align:center;">
        <h2 style="font-size:1.8rem; margin-bottom:5px;">Welcome, {{ user.username|title }}!</h2>
        <p style="font-size:1rem; color:#555;">Role: {{ user_role|title }}</p>
    </section>

    <!-- No Apps Assigned Message -->
    {% if show_no_apps_cta %}
        <div style="padding:15px; background:#fff3cd; border:1px solid #ffeeba; color:#856404; border-radius:5px; text-align:center; margin-bottom:30px;">
            You currently have no apps assigned. Please contact Admin.
        </div>
    {% endif %}

    <!-- Dashboard Cards -->
    {% if navigation %}
    <section class="dashboard-cards" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-bottom:40px;">
        {% for app in navigation %}
            <div class="card" style="padding:20px; border:1px solid #ddd; border-radius:8px; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.05); text-align:center;">
                <h3 style="margin-bottom:10px; font-size:1.2rem;">{{ app.name }}</h3>
                <a href="{{ app.url }}" style="display:inline-block; margin-top:10px; padding:8px 12px; background:#007bff; color:#fff; text-decoration:none; border-radius:5px; transition:0.3s;">
                    Go to {{ app.name }}
                </a>
            </div>
        {% endfor %}
    </section>
    {% endif %}

    <!-- Dashboard Stats -->
    <section class="dashboard-stats" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-bottom:40px;">
        <div class="stat-card" style="padding:20px; border:1px solid #ddd; border-radius:8px; background:#f8f9fa; text-align:center;">
            <h4 style="margin-bottom:10px;">Transactions Pending</h4>
            <p style="font-size:1.2rem; font-weight:bold;">{{ total_transactions_pending }}</p>
        </div>
        <div class="stat-card" style="padding:20px; border:1px solid #ddd; border-radius:8px; background:#f8f9fa; text-align:center;">
            <h4 style="margin-bottom:10px;">Treasury Pending</h4>
            <p style="font-size:1.2rem; font-weight:bold;">{{ treasury_pending }}</p>
        </div>
        <div class="stat-card" style="padding:20px; border:1px solid #ddd; border-radius:8px; background:#f8f9fa; text-align:center;">
            <h4 style="margin-bottom:10px;">Workflow Overdue</h4>
            <p style="font-size:1.2rem; font-weight:bold;">{{ workflow_overdue }}</p>
        </div>
        <div class="stat-card" style="padding:20px; border:1px solid #ddd; border-radius:8px; background:#f8f9fa; text-align:center;">
            <h4 style="margin-bottom:10px;">Reports Pending</h4>
            <p style="font-size:1.2rem; font-weight:bold;">{{ reports_pending }}</p>
        </div>
    </section>

    <!-- Phase 4: Pending Approvals -->
    <section style="margin-bottom:40px;">
        <h3 style="margin-bottom:20px;">Pending Approvals</h3>
        {% if pending_for_user %}
            <p>You have {{ pending_for_user|length }} requisition(s) pending your approval.</p>
            <table style="width:100%; border-collapse:collapse; margin-top:10px;">
                <thead>
                    <tr style="background:#f1f1f1;">
                        <th style="padding:10px; border:1px solid #ddd;">Transaction ID</th>
                        <th style="padding:10px; border:1px solid #ddd;">Requested By</th>
                        <th style="padding:10px; border:1px solid #ddd;">Amount</th>
                        <th style="padding:10px; border:1px solid #ddd;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in pending_for_user %}
                    <tr>
                        <td style="padding:10px; border:1px solid #ddd;">{{ req.transaction_id }}</td>
                        <td style="padding:10px; border:1px solid #ddd;">{{ req.requested_by.username }}</td>
                        <td style="padding:10px; border:1px solid #ddd;">{{ req.amount }}</td>
                        <td style="padding:10px; border:1px solid #ddd;">
                            {% if req.requested_by.id != user.id %}
                                <a href="{% url 'approve-requisition' req.transaction_id %}" style="margin-right:10px; padding:5px 10px; background:#28a745; color:#fff; text-decoration:none; border-radius:4px;">Approve</a>
                                <a href="{% url 'reject-requisition' req.transaction_id %}" style="padding:5px 10px; background:#dc3545; color:#fff; text-decoration:none; border-radius:4px;">Reject</a>
                            {% else %}
                                <span style="color:#856404;">Cannot approve your own requisition</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No requisitions pending your approval.</p>
        {% endif %}
    </section>

</div>
{% endblock %}
